name: opx-build
description: OpenSwitch build tools and environment
repository: "https://github.com/open-switch/opx-build"
skip_queued_branch_builds: true
skip_queued_branch_builds_filter: "!master"
provider_settings:
  build_pull_request_forks: true
  build_pull_requests: true
  build_tags: false
  prefix_pull_request_fork_branch_names: true
  publish_commit_status: true
  publish_commit_status_per_step: false
  pull_request_branch_filter_enabled: false
  skip_pull_request_builds_for_existing_commits: true
  trigger_mode: "code"
steps:
  - name: ":docker: opxhub/build"
    type: script
    command: ./docker_build.sh
  - type: waiter
  - name: ":docker: push"
    type: script
    branch_configuration: "master"
    command: |
      docker push opxhub/build:$(git log -1 --pretty=%h)
      docker push opxhub/build:latest
